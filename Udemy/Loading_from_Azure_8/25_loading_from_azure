CREATE OR REPLACE FILE FORMAT
    manage_db.file_formats.fileformat_azure_csv
TYPE='csv'
FIELD_DELIMITER=','
SKIP_HEADER=1;

-- Create Stage Object
CREATE OR REPLACE STAGE     
    manage_db.external_stages.csv_folder_azure
STORAGE_INTEGRATION=azure_integration
URL='azure://snowflakesa07.blob.core.windows.net/csv/'
FILE_FORMAT=manage_db.file_formats.fileformat_azure_csv;

LIST 
    @manage_db.external_stages.csv_folder_azure;

SELECT 
    $1, 
    $2, 
    $3, 
    $4,
    $5,
    $6,
    $7,
    $8,
    $9,
    $10,
    $11,
    $12,
    $13,
    $14,
    $15,
    $16,
    $17,
    $18,
    $19,
    $20
FROM 
    @manage_db.external_stages.csv_folder_azure 
LIMIT 10;

CREATE OR REPLACE TABLE our_first_db.public.happiness (
    country_name VARCHAR,
    regional_indicator VARCHAR,
    ladder_score NUMBER(4,3),  -- Total Number of digits, precision (decimal point)
    standard_error NUMBER(4,3),
    upperwhisker NUMBER(4,3),
    lowerwhisker NUMBER(4,3),
    logged_gdp NUMBER(5,3),
    social_support NUMBER(4,3),
    healthy_life_expectancy NUMBER(5,3),
    freedom_to_make_life_choices NUMBER(4,3),
    generosity NUMBER(4,3),
    perceptions_of_corruption NUMBER(4,3),
    ladder_score_in_dystopia NUMBER(4,3),
    explained_by_log_gpd_per_capita NUMBER(4,3),
    explained_by_social_support NUMBER(4,3),
    explained_by_healthy_life_expectancy NUMBER(4,3),
    explained_by_freedom_to_make_life_choices NUMBER(4,3),
    explained_by_generosity NUMBER(4,3),
    explained_by_perceptions_of_corruption NUMBER(4,3),
    dystopia_residual NUMBER(4,3));

SELECT 
    *
FROM 
    our_first_db.public.happiness;

COPY INTO 
    our_first_db.public.happiness
FROM 
    @manage_db.external_stages.csv_folder_azure;



SELECT 
    *
FROM 
    our_first_db.public.happiness
LIMIT
    10;

-- Load JSON

CREATE OR REPLACE FILE FORMAT
    manage_db.file_formats.fileformat_azure_json
TYPE='json';

CREATE OR REPLACE STAGE
    manage_db.external_stages.json_folder_azure
STORAGE_INTEGRATION=azure_integration
URL='azure://snowflakesa07.blob.core.windows.net/json/'
FILE_FORMAT=manage_db.file_formats.fileformat_azure_json;

LIST
    @manage_db.external_stages.json_folder_azure;

-- Query from stage
SELECT
    *
FROM 
    @manage_db.external_stages.json_folder_azure
LIMIT 
    10;

-- Query all attributes
SELECT 
    $1:"Car Model"::STRING AS car_model,
    $1:"Car Model Year"::INT AS car_model_year,
    $1:"car make"::STRING AS car_make,
    $1:"first_name"::STRING AS first_name,
    $1:"last_name"::STRING AS last_name
FROM 
    @manage_db.external_stages.json_folder_azure
LIMIT 
    10;

CREATE OR REPLACE TABLE
    our_first_db.public.car_owner(
        car_model VARCHAR(10),
        car_model_year INT,
        car_make VARCHAR(10),
        first_name VARCHAR(10),
        last_name VARCHAR(10)
    );

COPY INTO 
    our_first_db.public.car_owner
FROM (
    SELECT 
        $1:"Car Model"::STRING AS car_model,
        $1:"Car Model Year"::INT AS car_model_year,
        $1:"car make"::STRING AS car_make,
        $1:"first_name"::STRING AS first_name,
        $1:"last_name"::STRING AS last_name
    FROM 
        @manage_db.external_stages.json_folder_azure      
    )
TRUNCATECOLUMNS=TRUE;

SELECT 
    *
FROM 
    our_first_db.public.car_owner
LIMIT 
    10;