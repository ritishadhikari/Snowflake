USE DATABASE
    streams_db;

-- standard mode is Default which can be used to insert, update and delete
SHOW STREAMS;

SELECT 
    *
FROM 
    sales_raw_staging;

DROP STREAM 
    sales_stream;

-- Create stream with default
CREATE OR REPLACE STREAM 
    sales_stream_default
ON TABLE
    sales_raw_staging;

-- Create stream with append only
CREATE OR REPLACE STREAM 
    sales_stream_append
ON TABLE
    sales_raw_staging
APPEND_ONLY=TRUE;


SHOW STREAMS;

SELECT 
    *
FROM 
    sales_raw_staging;

INSERT INTO
    sales_raw_staging
VALUES
    (
        16,'Honey',4.99,1,1
    ),   
    (
        17,'Coffee',4.89,1,2
    ),
    (
        18,'Coffee',4.89,1,2
    );

-- All three records will exist in the default stream
SELECT 
    *
FROM 
    sales_stream_default;

-- All three records will also exist in the append only stream
SELECT 
    *
FROM 
    sales_stream_append;

-- Delete a record
DELETE FROM 
    sales_raw_staging
WHERE
    ID IN (17,18);


-- Now only one record with id 16 exist here
SELECT 
    *
FROM 
    sales_stream_default;

-- All three records will exist in the append only stream even after deletion from the table
SELECT 
    *
FROM 
    sales_stream_append;

-- Consume stream via "Create Table... AS"
CREATE OR REPLACE TEMPORARY TABLE
    product_table
AS
    SELECT 
        *
    FROM 
        sales_stream_default;

SELECT 
    *
FROM 
    product_table;

CREATE OR REPLACE TEMPORARY TABLE
    product_table
AS
    SELECT 
        *
    FROM 
        sales_stream_append;

SELECT 
    *
FROM 
    product_table;