CREATE OR REPLACE DATABASE 
    data_s;

CREATE OR REPLACE STAGE
    aws_stage
URL='s3://bucketsnowflakes3';

-- List files in stage
LIST 
    @aws_stage;

CREATE OR REPLACE TABLE 
    data_s.public.orders  (
    order_id VARCHAR(30),
    amount NUMBER(38,0),
    profit NUMBER(38,0),
    quantity NUMBER(38,0),
    category VARCHAR(30),
    SUBCATEGORY VARCHAR(30)
    );

-- Load data using the copy command
COPY INTO 
    data_s.public.orders
FROM 
    @data_s.public.aws_stage
FILE_FORMAT=(
    type='csv',
    field_delimiter=',',
    skip_header=1
)
PATTERN='.*OrderDetails.*';

SELECT 
    *
FROM
    data_s.public.orders
LIMIT
    10;

-- Create a share object
CREATE OR REPLACE SHARE
    orders_share;

-- Setup Grants on Database and Schema
GRANT USAGE ON DATABASE
    data_s
TO SHARE
    orders_share;

GRANT USAGE ON SCHEMA
    data_s.public
TO SHARE
    orders_share;

-- Grant SELECT on Table
GRANT SELECT ON TABLE
    data_s.public.orders
TO SHARE
    orders_share;

-- Validate Grants
SHOW GRANTS TO SHARE 
    orders_share;