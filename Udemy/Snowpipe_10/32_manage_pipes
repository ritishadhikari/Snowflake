DESC PIPE
    manage_db.pipes.employee_pipe;
    
-- show list of existing pipes
SHOW PIPES;

-- Search Pipes using Regular Expression
SHOW PIPES LIKE 
    '%employee%';

-- Search Pipes in a particular database
SHOW PIPES IN DATABASE 
    manage_db;

-- Search Pipes in a particular database with a regular expression
SHOW PIPES 
LIKE 
    '%employee%'
IN DATABASE 
    manage_db;

CREATE OR REPLACE TABLE
    our_first_db.public.employees2 (
        id INT,
        first_name STRING,
        last_name STRING,
        email STRING,
        location STRING,
        department STRING
    );

SELECT 
    COUNT(*)
FROM 
    our_first_db.public.employees2;

-- Pause Pipe
ALTER PIPE
    manage_db.pipes.employee_pipe
SET 
    PIPE_EXECUTION_PAUSED=TRUE;

-- Verify Pipe is paused and has pending file count as 0
SELECT
    system$pipe_status('manage_db.pipes.employee_pipe');

-- Recreate the Pipe to change the copy statement in the definition
CREATE OR REPLACE PIPE
    manage_db.pipes.employee_pipe
AUTO_INGEST=TRUE
AS
COPY INTO
    our_first_db.public.employees2
FROM
    @manage_db.external_stages.csv_folder;

-- Altering the Pipe
ALTER PIPE
    manage_db.pipes.employee_pipe REFRESH;

-- List files in Stage
LIST 
    @manage_db.external_stages.csv_folder;
 
SELECT 
    COUNT(*)
FROM 
    our_first_db.public.employees2;
    
-- -- copying existing data
-- COPY INTO
--     our_first_db.public.employees2
-- FROM
--     @manage_db.external_stages.csv_folder;

-- SELECT 
--     COUNT(*)
-- FROM 
--     our_first_db.public.employees2;

-- Resume Pipe
ALTER PIPE
    manage_db.pipes.employee_pipe
SET 
    PIPE_EXECUTION_PAUSED=FALSE;

-- Verify Pipe is running again
SELECT
    system$pipe_status('manage_db.pipes.employee_pipe');

SELECT 
    COUNT(*)
FROM 
    our_first_db.public.employees2;